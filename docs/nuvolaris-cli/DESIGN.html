<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Nuvolaris Docs | nuvolaris-cli/DESIGN</title><meta name="description" content="Nuvolaris documentation | nuvolaris-cli/DESIGN"/><link rel="icon" href="/pages-nuv-docs/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/pages-nuv-docs/_next/static/css/9635a546c21ac414.css" as="style"/><link rel="stylesheet" href="/pages-nuv-docs/_next/static/css/9635a546c21ac414.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/pages-nuv-docs/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/pages-nuv-docs/_next/static/chunks/webpack-6ccf84a01f2ed5c0.js" defer=""></script><script src="/pages-nuv-docs/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/pages-nuv-docs/_next/static/chunks/main-146843818b713b2d.js" defer=""></script><script src="/pages-nuv-docs/_next/static/chunks/pages/_app-a90987444c927ab0.js" defer=""></script><script src="/pages-nuv-docs/_next/static/chunks/187-2861d080c348caf8.js" defer=""></script><script src="/pages-nuv-docs/_next/static/chunks/pages/docs/%5Bslug%5D/%5Bmarkdown%5D-cf090ab2febc7cf1.js" defer=""></script><script src="/pages-nuv-docs/_next/static/eLhI_9Exmj8RmQ2OJYsWN/_buildManifest.js" defer=""></script><script src="/pages-nuv-docs/_next/static/eLhI_9Exmj8RmQ2OJYsWN/_ssgManifest.js" defer=""></script><script src="/pages-nuv-docs/_next/static/eLhI_9Exmj8RmQ2OJYsWN/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="flex flex-col h-screen justify-between"><div><div class="navbar bg-base-100 shadow-xl rounded-box fixed z-10"><div class="navbar-start"><div class="dropdown"><label tabindex="0" class="btn btn-ghost btn-circle"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg></label><ul tabindex="0" class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52"><li><a class="active:bg-info active:text-white" href="/pages-nuv-docs"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>Home</a></li><li><a class="active:bg-info active:text-white" href="/pages-nuv-docs/docs"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Docs</a></li><li><a class="active:bg-info active:text-white" href="/pages-nuv-docs/videos"><svg class="h-4 w-4" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M941.3 296.1a112.3 112.3 0 0 0-79.2-79.3C792.2 198 512 198 512 198s-280.2 0-350.1 18.7A112.12 112.12 0 0 0 82.7 296C64 366 64 512 64 512s0 146 18.7 215.9c10.3 38.6 40.7 69 79.2 79.3C231.8 826 512 826 512 826s280.2 0 350.1-18.8c38.6-10.3 68.9-40.7 79.2-79.3C960 658 960 512 960 512s0-146-18.7-215.9zM423 646V378l232 133-232 135z"></path></svg>Video</a></li></ul></div></div><div class="navbar-center align-middle"><img class="h-10 w-10" src="/pages-nuv-docs/nuv-logo.png"/><a class="normal-case text-xl " href="/pages-nuv-docs">Nuv-Docs</a></div><div class="navbar-end"><label for="modal" class="btn btn-ghost btn-circle modal-button btn-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></label><input type="checkbox" id="modal" class="modal-toggle" value="toggle search"/><div class="modal items-baseline"><div class="modal-box relative rounded-t-none rounded-b-lg sm:rounded-lg"><label for="modal" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label><h3 class="text-lg font-bold">Search in the docs</h3><br/><form class="form-control"><div class="input-group w-full"><input type="text" placeholder="Search…" class="input input-bordered w-full" value=""/><button class="btn btn-square" disabled=""><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button></div></form></div></div><div class="tooltip tooltip-bottom before:text-xs before:content-[attr(data-tip)]" data-tip="github"><a class="btn btn-ghost btn-circle normal-case btn-sm" href="https://github.com/nuvolaris/nuvolaris" target="_blank" rel="noopener noreferrer"><svg width="24" height="24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z"></path></svg></a></div><label class="swap swap-rotate"><input type="checkbox" data-toggle-theme="dark,light" data-act-class="ACTIVECLASS"/><svg class="fill-current w-6 h-6 swap-off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"></path></svg><svg class="fill-current w-6 h-6 swap-on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"></path></svg></label></div></div><main class="container mx-auto mt-20"><div class="prose mx-2 sm:mx-auto"><div class="text-sm breadcrumbs"><ul><li><a href="/pages-nuv-docs/docs">Docs</a></li><li><a>nuvolaris-cli</a></li><li><a>design</a></li><li><div class="tooltip tooltip-right overflow-x-hidden sm:overflow-visible" data-tip="nuvolaris-cli"><a class="btn btn-circle btn-outline btn-sm" href="https://github.com/nuvolaris/nuvolaris-cli" target="_blank" rel="noopener noreferrer"><svg width="24" height="24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z"></path></svg></a></div></li></ul></div><div class="break-all"><p>&lt;!--
~ Licensed to the Apache Software Foundation (ASF) under one
~ or more contributor license agreements.  See the NOTICE file
~ distributed with this work for additional information
~ regarding copyright ownership.  The ASF licenses this file
~ to you under the Apache License, Version 2.0 (the
~ &quot;License&quot;); you may not use this file except in compliance
~ with the License.  You may obtain a copy of the License at
~
~   http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing,
~ software distributed under the License is distributed on an
~ &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
~ KIND, either express or implied.  See the License for the
~ specific language governing permissions and limitations
~ under the License.
~
--&gt;</p>
<h1>Design</h1>
<p><strong>NOTE</strong> This design is work in progress and incomplete - feel free to propose improvements but <strong>please document the feature and send a PR to this design BEFORE implementing the feature</strong> to avoid rejections and time wasted.</p>
<h2>Goals</h2>
<p>The tool <code>nuv</code> built in the repo <a href="https://github.com/nuvolaris/nuvolaris-cli">nuvolaris-cli</a> it the Command Line Interface for the Nuvolaris project.</p>
<p>It embeds the functionalities of the tool <a href="https://github.com/apache/openwhisk-cli">wsk</a> for creating actions. Since wsk is written in Go, we can directly include the code in <code>nuv</code></p>
<p>It embeds the functionalities of the tool <a href="https://taskfile.dev">task</a> for execution actions. Since task is written in Go, we can directly include the code in <code>nuv</code></p>
<p>It also adds some project conventions inspired by the <a href="https://github.com/nimbella/nimbella-cli">nim</a> tool. But since nim is written in typescript we do not include it, but will reimplement it. Most notably we want to reimplement the <a href="#project-detection">project detection</a> heuristic described below and nothing else.</p>
<p>The tool works by scanning the current subtree, looking for actions and packages to deploy. It generates a <code>Taskfile</code> (that can be inspected by the users) and then executes it.</p>
<p>It will be possible to add customizations of the task adding locally <code>nuvolaris.yml</code> in the various subdirectories. This functionality will be described later.</p>
<p>Initially, there will be 4 commands:</p>
<ul>
<li><code>nuv scan</code> scans the folder and generates a Taskfile</li>
<li><code>nuv wsk</code> executes the wsk subcommand</li>
<li><code>nuv task</code> executes the task subcommand</li>
<li><code>nuv setup</code> will also be able to execute a kubectl command that deploys the <code>nuvolaris-operator</code> that in turns inizializes openwhisk in any available kubernetes accessible with <code>kubectl</code> and initialize the <code>.wskprops</code> file used by <code>nuv wsk</code></li>
</ul>
<p>The expected workflow is that:</p>
<ol>
<li><code>nuv setup</code> installs an openwhisk cluster using <code>kubectl</code> configured in the path</li>
<li><code>nuv scan</code> generates a <code>Taskfile</code></li>
<li><code>nuv task</code> executes the <code>Taskfile</code> that embeds many <code>nuv wsk</code> commands</li>
<li>the various <code>nuv wsk</code> create then a full project</li>
</ol>
<p>An example of a project to deploy can be <a href="https://github.com/pagopa/io-sdk/tree/master/admin">this</a></p>
<h2>Project Detection</h2>
<p><code>nuv</code> will scan the current directory looking for a folder named <code>packages</code></p>
<p>If it finds here a file, it will create a package for each subfolder.</p>
<p>If it finds files in the file <code>packages</code>, it will deploy them as <a href="#single-file-actions">single file actions</a> in the package <code>default</code>. If it finds files in the subfolders of <code>packages</code> it will deploy them as <a href="#single-file-actions">single file actions</a> in packages named as the the subfolder. If it finds folders it will build <a href="#multi-file-actions">multi file actions</a>.</p>
<h2>Single File Actions</h2>
<p>A single file actions is simply a file with an extension.</p>
<p>This extension can be one of the supported ones: <code>.js</code>  <code>.py</code> <code>.go</code> <code>.java</code></p>
<p>This will cause the creation of an action with <code>--kind nodejs:default</code>, <code>--kind python:default</code>, <code>--kind go:default</code> and <code>--kind java:default</code> using the correct runtime.</p>
<p>The correct runtime is described by <code>runtime.json</code> that can be downloaded from the configured api host.</p>
<p>If the extension is in format:  <code>.&lt;version&gt;.&lt;extension&gt;</code>, it will deploy an action of  <code>--kind &lt;language&gt;:&lt;version&gt;</code></p>
<h2>Static frontend</h2>
<p>Nuv is also able to deploy static frontends. A static front-end is a collection of static asset under a given folder that will be published in a web server under a path.</p>
<p>A folder containing static (web) assets is always named <code>web</code> and can be placed in different parts in the folder hierarchy. The path in the website where is published depends on the location in the hierarchy, as described below.</p>
<p>Before publishing, <code>nuv</code> executes some build commands.</p>
<h3>Hostname</h3>
<p>In general, for each namespace there will be a <code>https://&lt;namespace&gt;.&lt;domain&gt;</code> website where to publish the resources. For the local deployment there will be a website <code>http://127.0.0.1:8080</code> where the resources are published, with the namespace and the domain ignored.</p>
<h3>Path detection</h3>
<p>The path where the assets are published depends on the path in the action hierarchy.</p>
<p>The sub-folder <code>web</code> is published as &quot;/&quot;.</p>
<p>Any subfolder <code>web</code> under <code>packages/&lt;package&gt;/web</code> is published unser <code>/&lt;packages&gt;/</code>.</p>
<p>Any subfolder <code>web</code> under <code>packages/default/&lt;action&gt;\web</code> is published as <code>/&lt;action&gt;</code>.</p>
<p>Any subfolder <code>web</code> under <code>packages/&lt;package&gt;/&lt;action&gt;/web</code> is published as <code>/&lt;package&gt;/&lt;action&gt;</code></p>
<p>What is published (files collected) and how it is built is defined by the next paragraph.</p>
<h3>Building and Collecting</h3>
<p>In every folder <code>web</code> it will check if there is a <code>nuvolaris.json</code></p>
<p>If there is not a <code>nuvolaris.json</code> and not a <code>package.json</code> it will assume this base <code>nuvolaris.json</code>:</p>
<pre><code>{
  &quot;collect&quot;: &quot;.&quot;,
  &quot;install&quot;: &quot;echo nothing to install&quot;,
  &quot;build&quot;: &quot;echo nothing to build&quot;
}
</code></pre>
<p>If instead there is <code>packages.json</code>, it will assume this base <code>nuvolaris.json</code>:</p>
<pre><code>{
  &quot;collect&quot;: &quot;public&quot;,
  &quot;install&quot;: &quot;npm install&quot;,
  &quot;build&quot;: &quot;npm run build&quot;
}
</code></pre>
<p>The it will read the <code>nuvolaris.json</code> replacing the keys in it with the default ones.</p>
<p>The generated taskfile will execute at deployment step:</p>
<ul>
<li>the command defined by <code>install</code> only if there is not a <code>node_modules</code></li>
<li>the command defined by <code>build</code> always</li>
<li>then it will collect for publishing (creating a crd instance) the files in the folder defined by <code>collect</code></li>
</ul>
<p>It is recommended that <code>nuv scan</code> does not execute directy the command but instead it delegates to another command like <code>nuv build</code> and in turn the creation of <code>crd</code> to another <code>nuv crd</code> subcommand, after changing to the corresponding suddirectory. All those commands should work by default in current directory.</p>
<h2>Multi File Actions</h2>
<p><strong>initial draft</strong></p>
<p>A multi-file action is stored in a subfolder of a subfolder of <code>packages</code>.</p>
<p>This is expected to be a file to build.</p>
<p><code>nuv</code> implements some heuristics to decide the correct type of the file to build.</p>
<p>Currently:</p>
<ul>
<li>if there is a <code>package.json</code>  or any <code>js</code> field in the folder then it is  <code>.js</code> and it builds with <code>npm install ; npm build</code></li>
<li>if there is a <code>requirements.txt</code> or any <code>.py</code> file then it is python and it builds creating a virtual env as described in the python runtime documentation</li>
<li>if there is <code>pom.xml</code> then it builds using <code>mvn install</code></li>
<li>if there is a <code>go.mod</code> then it builds using <code>go build</code></li>
</ul>
<p>then it will zip the folder and send as an action of the current type to the runtime.</p>
</div></div></main></div><footer class="text-gray-600 body-font "><div class="container px-5 py-4 mx-auto flex items-center sm:flex-row flex-col"><a class="flex title-font font-medium items-center md:justify-start justify-center text-primary"><img src="/pages-nuv-docs/nuv-logo.png" class="w-12 h-12 p-2 rounded-full"/><span class="ml-3 text-xl">Nuvolaris</span></a><p class="text-sm text-gray-500 sm:ml-4 sm:pl-4 sm:border-l-2 sm:border-gray-200 sm:py-2 sm:mt-0 mt-4">© 2021 Nuvolaris —<a href="#" class="text-gray-600 ml-1" rel="noopener noreferrer" target="_blank">@nuv</a></p><span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start"><a class="ml-3 text-gray-500"><svg fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="0" class="w-5 h-5" viewBox="0 0 24 24"><path stroke="none" d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"></path><circle cx="4" cy="4" r="2" stroke="none"></circle></svg></a><a class="ml-3 text-gray-500"><svg fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z"></path></svg></a></span></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"content":"\u003c!--\n  ~ Licensed to the Apache Software Foundation (ASF) under one\n  ~ or more contributor license agreements.  See the NOTICE file\n  ~ distributed with this work for additional information\n  ~ regarding copyright ownership.  The ASF licenses this file\n  ~ to you under the Apache License, Version 2.0 (the\n  ~ \"License\"); you may not use this file except in compliance\n  ~ with the License.  You may obtain a copy of the License at\n  ~\n  ~   http://www.apache.org/licenses/LICENSE-2.0\n  ~\n  ~ Unless required by applicable law or agreed to in writing,\n  ~ software distributed under the License is distributed on an\n  ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n  ~ KIND, either express or implied.  See the License for the\n  ~ specific language governing permissions and limitations\n  ~ under the License.\n  ~\n--\u003e\n\n# Design\n\n**NOTE** This design is work in progress and incomplete - feel free to propose improvements but **please document the feature and send a PR to this design BEFORE implementing the feature** to avoid rejections and time wasted.\n\n## Goals\n\nThe tool `nuv` built in the repo [nuvolaris-cli](https://github.com/nuvolaris/nuvolaris-cli) it the Command Line Interface for the Nuvolaris project.\n\nIt embeds the functionalities of the tool [wsk](https://github.com/apache/openwhisk-cli) for creating actions. Since wsk is written in Go, we can directly include the code in `nuv`\n\nIt embeds the functionalities of the tool [task](https://taskfile.dev) for execution actions. Since task is written in Go, we can directly include the code in `nuv`\n\nIt also adds some project conventions inspired by the [nim](https://github.com/nimbella/nimbella-cli) tool. But since nim is written in typescript we do not include it, but will reimplement it. Most notably we want to reimplement the [project detection](#project-detection) heuristic described below and nothing else.\n\nThe tool works by scanning the current subtree, looking for actions and packages to deploy. It generates a `Taskfile` (that can be inspected by the users) and then executes it.\n\nIt will be possible to add customizations of the task adding locally `nuvolaris.yml` in the various subdirectories. This functionality will be described later.\n\nInitially, there will be 4 commands:\n\n- `nuv scan` scans the folder and generates a Taskfile \n- `nuv wsk` executes the wsk subcommand\n- `nuv task` executes the task subcommand\n- `nuv setup` will also be able to execute a kubectl command that deploys the `nuvolaris-operator` that in turns inizializes openwhisk in any available kubernetes accessible with `kubectl` and initialize the `.wskprops` file used by `nuv wsk`\n\nThe expected workflow is that:\n1. `nuv setup` installs an openwhisk cluster using `kubectl` configured in the path\n2. `nuv scan` generates a `Taskfile` \n3. `nuv task` executes the `Taskfile` that embeds many `nuv wsk` commands\n4. the various `nuv wsk` create then a full project\n\nAn example of a project to deploy can be [this](https://github.com/pagopa/io-sdk/tree/master/admin)\n\n## Project Detection\n`nuv` will scan the current directory looking for a folder named `packages` \n\nIf it finds here a file, it will create a package for each subfolder.\n\nIf it finds files in the file `packages`, it will deploy them as [single file actions](#single-file-actions) in the package `default`. If it finds files in the subfolders of `packages` it will deploy them as [single file actions](#single-file-actions) in packages named as the the subfolder. If it finds folders it will build [multi file actions](#multi-file-actions).\n\n## Single File Actions\n\nA single file actions is simply a file with an extension.\n\nThis extension can be one of the supported ones: `.js`  `.py` `.go` `.java` \n\nThis will cause the creation of an action with `--kind nodejs:default`, `--kind python:default`, `--kind go:default` and `--kind java:default` using the correct runtime.\n\nThe correct runtime is described by `runtime.json` that can be downloaded from the configured api host.\n\nIf the extension is in format:  `.\u003cversion\u003e.\u003cextension\u003e`, it will deploy an action of  `--kind \u003clanguage\u003e:\u003cversion\u003e`\n\n## Static frontend\n\nNuv is also able to deploy static frontends. A static front-end is a collection of static asset under a given folder that will be published in a web server under a path. \n\nA folder containing static (web) assets is always named `web` and can be placed in different parts in the folder hierarchy. The path in the website where is published depends on the location in the hierarchy, as described below.\n\nBefore publishing, `nuv` executes some build commands.\n\n### Hostname\n\nIn general, for each namespace there will be a `https://\u003cnamespace\u003e.\u003cdomain\u003e` website where to publish the resources. For the local deployment there will be a website `http://127.0.0.1:8080` where the resources are published, with the namespace and the domain ignored.\n\n### Path detection\n\nThe path where the assets are published depends on the path in the action hierarchy.\n\nThe sub-folder `web` is published as \"/\".\n\nAny subfolder `web` under `packages/\u003cpackage\u003e/web` is published unser `/\u003cpackages\u003e/`.\n\nAny subfolder `web` under `packages/default/\u003caction\u003e\\web` is published as `/\u003caction\u003e`.\n\nAny subfolder `web` under `packages/\u003cpackage\u003e/\u003caction\u003e/web` is published as `/\u003cpackage\u003e/\u003caction\u003e`\n\nWhat is published (files collected) and how it is built is defined by the next paragraph.\n\n### Building and Collecting\n\nIn every folder `web` it will check if there is a `nuvolaris.json`\n\nIf there is not a `nuvolaris.json` and not a `package.json` it will assume this base `nuvolaris.json`:\n\n```\n{\n  \"collect\": \".\",\n  \"install\": \"echo nothing to install\",\n  \"build\": \"echo nothing to build\"\n}\n```\n\nIf instead there is `packages.json`, it will assume this base `nuvolaris.json`:\n\n```\n{\n  \"collect\": \"public\",\n  \"install\": \"npm install\",\n  \"build\": \"npm run build\"\n}\n```\n\nThe it will read the `nuvolaris.json` replacing the keys in it with the default ones.\n\nThe generated taskfile will execute at deployment step:\n\n- the command defined by `install` only if there is not a `node_modules`\n- the command defined by `build` always\n- then it will collect for publishing (creating a crd instance) the files in the folder defined by `collect`\n\nIt is recommended that `nuv scan` does not execute directy the command but instead it delegates to another command like `nuv build` and in turn the creation of `crd` to another `nuv crd` subcommand, after changing to the corresponding suddirectory. All those commands should work by default in current directory. \n\n\n\n\n## Multi File Actions\n\n**initial draft**\n\nA multi-file action is stored in a subfolder of a subfolder of `packages`.\n\nThis is expected to be a file to build.\n\n`nuv` implements some heuristics to decide the correct type of the file to build.\n\nCurrently:\n\n- if there is a `package.json`  or any `js` field in the folder then it is  `.js` and it builds with `npm install ; npm build`\n- if there is a `requirements.txt` or any `.py` file then it is python and it builds creating a virtual env as described in the python runtime documentation\n- if there is `pom.xml` then it builds using `mvn install`\n- if there is a `go.mod` then it builds using `go build`\n\nthen it will zip the folder and send as an action of the current type to the runtime.\n\n\n\n\n\n\n\n","slug":"nuvolaris-cli","markdown":"DESIGN"},"__N_SSG":true},"page":"/docs/[slug]/[markdown]","query":{"slug":"nuvolaris-cli","markdown":"DESIGN"},"buildId":"eLhI_9Exmj8RmQ2OJYsWN","assetPrefix":"/pages-nuv-docs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>